<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" ...>
    <link rel="stylesheet" href="/lightTheme.css" th:if="${settings.currentTheme == T(com.example.EduCabinet.model.Settings.Theme).LIGHT}">
    <link rel="stylesheet" href="/darkTheme.css" th:if="${settings.currentTheme == T(com.example.EduCabinet.model.Settings.Theme).DARK}">
    <title>Settings</title>
</head>
<body>
<div class="container">
<div class="container">
    <ul class="nav nav-tabs">
        <li class="nav-item">
            <a class="nav-link"  href="/api/students/mystats" th:if="${role == 'STUDENT'}" >Dashboard</a>
            <a class="nav-link"  href="/api/teachers/teacherdashboard" th:if="${role == 'TEACHER'}" >Dashboard</a>
        </li>

        <li class="nav-item">
            <a class="nav-link active" aria-current="page">Settings</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/message">Messages</a>
        </li>
        <li>
            <a class="nav-link disabled" aria-current="page" aria-disabled="true" href="#" th:if="${role == 'TEACHER'}" >Create new Account</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/login">Logout</a>
        </li>
    </ul>
    <header>
        <h6>Hello, <span th:text="${name}"></span>!</h6>

    </header>
    <br>
<!--    answer from server if successfull saved changes answer and error is String-->
    <div th:if="${answer != null}" class="alert alert-success" role="alert">
        <span th:text="${answer}"></span>
    </div>
    <div th:if="${error != null}" class="alert alert-danger" role="alert">
        <span th:text="${error}"></span>
    </div>
</div>
<div class="row">
    <div class="col-md-3 p-0">
        <div class="sidebar" style="position: fixed; top: 45%; left: 20%; height: 100%; overflow-y: auto; z-index: 1000; width: 250px;">
            <div class="list-group">
                <a class="list-group-item list-group-item-action" href="#profile">Profile</a>
                <a class="list-group-item list-group-item-action" href="#password">Change Password</a>
                <a class="list-group-item list-group-item-action" href="#notifications">Notifications</a>
                <a class="list-group-item list-group-item-action" href="#customization">Customization Settings</a>
            </div>
        </div>
    </div>
    <div class="col-md-5 offset-md-3">
        <div id="profile" class="card mb-3">
            <div class="card-header">Profile Settings</div>
            <div class="card-body">
                <p>Update your profile information below:</p>
                <form action="/settings/changeprofile" method="post">
                    <div class="mb-3">
                        <label for="login" class="form-label">Login</label>
                        <input type="text" class="form-control" id="login"  name="login" placeholder="Enter your login">
                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" name="email" placeholder="Enter your email">
                    </div>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </form>
            </div>
        </div>
        <div id="password" class="card mb-3">
            <div class="card-header">Change Password</div>
            <div class="card-body">
                <p>Change your password below:</p>
                <form  action="/settings/updatepassword" method="post">
                    <div class="mb-3">
                        <label for="oldPassword" name="oldPassword" class="form-label">Current Password</label>
                        <input type="password" class="form-control" id="oldPassword" name="oldPassword" placeholder="Enter current password">
                    </div>
                    <div class="mb-3">
                        <label for="newPassword" name="newPassword" class="form-label">New Password</label>
                        <input type="password" class="form-control" id="newPassword" name="newPassword" placeholder="Enter new password">
                    </div>
                    <button type="submit" class="btn btn-primary">Change Password</button>
                </form>
            </div>
        </div>
        <div id="notifications" class="card mb-3">
            <div class="card-header">Notifications</div>
            <div class="card-body">
                <div class="form-check form-switch">
                    <input class="form-check-input"  type="checkbox" role="switch" id="switchCheckNotifications" checked>
                    <label class="form-check-label" for="switchCheckNotifications">Enable/Disable notifications</label>
                </div>
            </div>
        </div>
        <div id="customization" class="card mb-3">
            <div class="card-header">Customization Settings</div>
            <div class="card-body">
                <br>
                <h5>Theme settings</h5>
                <br>
                <form th:action="@{/settings/updatetheme}" method="post">
                    <div class="form-check form-switch">
                        <input class="form-check-input" th:checked="${settings.currentTheme == T(com.example.EduCabinet.model.Settings.Theme).DARK}" type="checkbox" role="switch" id="switchCheckTheme" name="theme" onchange="this.form.submit()">
                        <label class="form-check-label" for="switchCheckTheme">Dark/Light</label>
                    </div>
                </form>
                <br>
                <h5>Language settings</h5>
                <br>
                    <select class="form-select" aria-label="Change Language" style="width: 400px; margin-top: 10px;" disabled>
                        <option selected>Change language at this time is not enable</option>
                        <option value="1">Українська</option>
                        <option value="2">English</option>
                        <option value="3">Deutsch</option>
                    </select>
            </div>
        </div>
    </div>

</div>
<th:block th:replace="fragments/footer :: footer(settings=${settings})"></th:block>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const navLinks = document.querySelectorAll(".list-group-item");
        const sections = document.querySelectorAll("div[id]");


        if (window.location.pathname === "/settings/") {
            activateLinkById("profile");
        }




        function activateLinkById(id) {
            navLinks.forEach(link => {
                link.classList.toggle("active", link.getAttribute("href") === `#${id}`);
            });
        }


        navLinks.forEach(link => {

            link.addEventListener("click", function () {
                const targetId = this.getAttribute("href").substring(1);
                activateLinkById(targetId);
            });
        });


        window.addEventListener("scroll", function () {
            let currentSectionId = "";
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (window.scrollY >= sectionTop - 80) {
                    currentSectionId = section.getAttribute("id");
                }
            });
            if (currentSectionId) {
                activateLinkById(currentSectionId);
            }
        });
    });
</script>
</body>
</html>